<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>生成图片分享</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        html{
            font-size: 20px;
        }
        .canvasAll{
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #canvasBox{
            border: 1px solid #eee;
            border-radius: .3rem;
            box-shadow: 0 .2rem 1rem rgba(0,0,0,.2);
        }
        #imgBg,#output{
            display: none;
        }
    </style>
</head>
<body>
    <div class="canvasAll">
        <canvas id="canvasBox" width="300" height="480">
            <span>你的版本不支持canvas，请升级</span>
        </canvas>
    </div>
    <div>
        <img id="imgBg" src="imgBg.jpg" alt="">
    </div>
    <div id="output"></div>
</body>
<script src="jquery.js"></script>
<script src="jquery.qrcode.min.js"></script>
<script>
    $(function(){
        draw();
        // canvas2Img();
        console.log(canvas2Img());
    })    

    //canvas绘图
    function draw(){
        var imgBg2 = document.getElementById('imgBg'); 

        $('#output').qrcode("http://www.baidu.com");      
        var strDataURI=$('#output canvas')[0].toDataURL("image/png"); 
        var qrImg = new Image();
        qrImg.src = strDataURI;               

        var canvas = document.getElementById("canvasBox");
        var ctx = canvas.getContext("2d");
        var h = $(canvas).height();//百分1的高
        var w = $(canvas).width();//百分1的宽
        
        ctx.beginPath();
        ctx.font="1.2rem Arial";
        ctx.fillStyle = "#4a4a4a"; 
        ctx.textAlign='center';
        ctx.fillText("小 饼 乱 语",150,54);

        ctx.beginPath();
        ctx.font="0.75rem YaHei";
        ctx.fillStyle = "#727272"; 
        ctx.textAlign='center';
        ctx.fillText('"要有点耐心"',150,280);

        ctx.beginPath();
        ctx.font="0.65rem YaHei";
        ctx.fillStyle = "#aaa9af"; 
        ctx.textAlign='center';
        ctx.fillText('戊戍年 壬戍月 己丑日',150,340);

        ctx.beginPath();
        ctx.font="0.65rem YaHei";
        ctx.fillStyle = "#aaa9af"; 
        ctx.textAlign='center';
        ctx.fillText('今日签语',150,370);

        
        ctx.beginPath();
        window.onload = function(){
            ctx.drawImage(imgBg2, 30, 80, 240, 160)
            ctx.drawImage(qrImg, 120, 390, 60, 60)            
        }
    }

    function canvas2Img(){
        var canvasBoxURI=$('#canvasBox')[0].toDataURL("image/png"); 
        var canvasBoxImg = new Image();
        canvasBoxImg.src = canvasBoxURI;  
        return canvasBoxImg;
    }

    function saveImg(){
        wx.config({
            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: '<%=appid%>', // 必填，公众号的唯一标识
            timestamp: '<%=timestamp%>', // 必填，生成签名的时间戳
            nonceStr: '<%=nonce%>', // 必填，生成签名的随机串
            signature: '<%=signature%>',// 必填，签名，见附录1
            jsApiList: ["checkJsApi", "onMenuShareTimeline", "onMenuShareAppMessage"] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            //当前客户端版本是否支持指定JS接口,分享到朋友圈,分享给朋友
        }); 
        wx.ready(function () {

            wx.checkJsApi({
                jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
                success: function (res) {
                    alert(JSON.stringify(res));
                    // 以键值对的形式返回，可用的api值true，不可用为false
                    // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
                }
            });
            //朋友圈
            wx.onMenuShareTimeline({
                title: '春天里的健康', // 分享标题
                desc: '春天里的健康春天里的健康春天里的健康', // 分享描述
                link: '<%=thisUrl%>', // 分享链接
                imgUrl: 'https://imgsa.baidu.com/baike/c0%3Dbaike116%2C5%2C5%2C116%2C38/sign=c31e0863bf315c60579863bdecd8a076/4034970a304e251fb62a408ea486c9177e3e53e2.jpg',
                success: function (res) {
                    alert('已分享');
                },
                cancel: function (res) {
                    alert('已取消');
                },
                fail: function (res) {
                    alert(JSON.stringify(res));
                }
            });

            //朋友
            wx.onMenuShareAppMessage({
                title: '春天里的健康', // 分享标题
                desc: '春天里的健康春天里的健康春天里的健康', // 分享描述
                link: '<%=thisUrl%>', // 分享链接
                imgUrl: 'https://imgsa.baidu.com/baike/c0%3Dbaike116%2C5%2C5%2C116%2C38/sign=c31e0863bf315c60579863bdecd8a076/4034970a304e251fb62a408ea486c9177e3e53e2.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    // 用户确认分享后执行的回调函数
                    alert("分享成功");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                    alert("取消分享");
                }
            });

        });

    }
</script>

</html>